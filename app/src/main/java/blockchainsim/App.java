/*
 * This source file was generated by the Gradle 'init' task
 */
package blockchainsim;

import org.checkerframework.checker.units.qual.C;
import org.checkerframework.checker.units.qual.N;

import java.io.File;
import java.security.PublicKey;
import java.util.*;

public class App {


    public static void main(String[] args) throws Exception {

        // ====================== BLOCKCHAIN & GENESIS NODE SETUP =============================

        Block genBlock = BlockUtil.readBlock(new File("app/src/main/resources/BlockData/block0000000000.json"));

        Blockchain blockchain = Blockchain.getInstance();

        Miner miner = new Miner(blockchain);

        Wallet minerWallet = WalletUtil.loadWallet("app/src/main/resources/WalletData/minerWallet.json");

        System.out.println(minerWallet.getPublicAddress() + " " + minerWallet.getPublicKey() + " " + minerWallet.getPrivateKey());

        Wallet wallet1 = new Wallet();

        Node node = new Node(blockchain);
        node.buildLocalChainData("app/src/main/resources/BlockData");
        System.out.println(node.getUtxoPool().entrySet());

//        PeerTransaction tx = new PeerTransaction((PublicKey) minerWallet.getPublicKey(), (PublicKey) wallet1.getPublicKey(), 20.0);
//        tx.signTransaction(minerWallet.getPrivateKey());
//
//        System.out.println(
//                node.getUtxoPool().get(0).getAddress() + "\n" + tx.getSender()
//        );
//
//        node.verifyTransaction(tx);
//
//        System.out.println(tx.getInputs() + "\n" + tx.getOutputs());
//
//        Block block = new Block(1, genBlock.getHash(), blockchain.getDifficulty());
//
//        block.addTransaction(new CoinbaseTransaction((PublicKey) minerWallet.getPublicKey(), 50.0));
//        block.addTransaction(tx);
//
//        miner.mineBlock(block, block.getDifficulty());
//
//        BCProtocol.verifyBlockHash(block);
//
//        BlockUtil.storeBlock(block);

//        //Genesis block creation, with coinbase transaction
//        Block GenesisBlock = new Block(0, "00000000000000000000", blockchain.getDifficulty());
//        GenesisBlock.addTransaction(new CoinbaseTransaction((PublicKey) minerWallet.getPublicKey(), 50.0));
//
//        System.out.println("\n-------------\nGenesis block\n-------------\nHash: " + GenesisBlock.getHash() + "\nNonce: " + GenesisBlock.getNonce());
//
//        //TEST TRANSACTION/VERIFICATION TO ADD TO BLOCK------------------------------------------------
//
//
//        //---------------------------------------------------------------------------------------------
//
//        // Mine Genesis Block
//        miner.mineBlock(GenesisBlock, blockchain.getDifficulty());
//
//        //Verify Genesis block with proof of work
//        BCProtocol.verifyBlockHash(GenesisBlock);
//
//        //Serialize block into json format
//        BlockUtil.storeBlock(GenesisBlock);
//
//        //De-serialize block from json back into block object
//        Block block = BlockUtil.readBlock(new File("app/src/main/resources/BlockData/block0000000000.json"));
//
//        //Check block is valid
//        BCProtocol.verifyBlockHash(block);



    }



}
