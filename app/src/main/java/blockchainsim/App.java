/*
 * This source file was generated by the Gradle 'init' task
 */
package blockchainsim;

import org.checkerframework.checker.units.qual.C;
import org.checkerframework.checker.units.qual.N;

import java.security.PublicKey;
import java.util.*;

public class App {

    ///TODO the decentralise Nodes UTXO stores by calculating it from reading the blockchain
    ///TODO Add mining reward for mining blocks

    public static void main(String[] args) throws Exception {

        // ====================== BLOCKCHAIN & GENESIS NODE SETUP =============================

        Blockchain blockchain = Blockchain.getInstance();

        Miner miner = new Miner(blockchain);
        Wallet minerWallet = new Wallet();

        // Genesis block creation, with coinbase transaction
        Block GenesisBlock = new Block(0, "00000000000000000000", blockchain.getDifficulty());
        GenesisBlock.addTransaction(new CoinbaseTransaction((PublicKey) minerWallet.getPublicKey(), 50.0));

        System.out.println("\n-------------\nGenesis block\n-------------\nHash: " + GenesisBlock.getHash() + "\nNonce: " + GenesisBlock.getNonce());

        Node node1 = new Node(blockchain);

        Wallet wallet1 = new Wallet();
        Wallet wallet2 = new Wallet();

        node1.addUTXOtoPool(new UTXO("tx1", null, wallet1.getPublicAddress(), 10.0));

        PeerTransaction tx = new PeerTransaction((PublicKey) wallet1.getPublicKey(), (PublicKey) wallet2.getPublicKey(), 5.0);
        tx.signTransaction(wallet1.getPrivateKey());

        System.out.println(node1.verifyTransaction(tx));

        System.out.println(tx.getInputs() + " " + tx.getOutputs());

        GenesisBlock.addTransaction(tx);

        miner.mineBlock(GenesisBlock, blockchain.getDifficulty());

        BCProtocol.verifyBlockHash(GenesisBlock);

        BlockUtil.storeBlock(GenesisBlock);
    }



}
